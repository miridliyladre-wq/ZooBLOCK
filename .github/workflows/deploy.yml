name: Deploy to App Store

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode.app
        
      - name: Install Fastlane
        run: gem install fastlane
        
      - name: Build & Upload
        env:
          APPLE_ID: ${{ secrets.APPLE_ID }}
          APPLE_PASSWORD: ${{ secrets.APPLE_PASSWORD }}
          TEAM_ID: ${{ secrets.TEAM_ID }}
          BUNDLE_ID: ${{ secrets.BUNDLE_ID }}
        run: |
          cd ZooBLOCK_iOS
          fastlane pilot upload \
            --username "$APPLE_ID" \
            --app_identifier "$BUNDLE_ID" \
            --team_id "$TEAM_ID" \
            --ipa "ZooBLOCK.ipa"
